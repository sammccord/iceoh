!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((i=i||self).iceoh={})}(this,function(i){function t(){return(t=Object.assign||function(i){for(var t=1;t<arguments.length;t++){var e=arguments[t];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(i[n]=e[n])}return i}).apply(this,arguments)}var e,n=Math.atan(.5),s=Math.PI/6,o=Math.PI/4,r={x:0,y:0},h={x:.5,y:.5},a={x:1,y:1};function l(i,t,e){for(var n=i;t.length-1;){var s=t.shift();s in n||(n[s]={}),n=n[s]}return n[t[0]]=e,n[t[0]]}function u(i,t,e){for(var n=i;t.length;){var s=t.shift();if(!(s in n)){if(!e)return;n[s]={},t.length||(n[s]=e)}n=n[s]}return n}function c(i){return i.reduce(function(i,t){return t?i+t:i},0)}(e=i.DIRECTION||(i.DIRECTION={})).NONE="NONE",e.N="N",e.NE="NE",e.E="E",e.SE="SE",e.S="S",e.SW="SW",e.W="W",e.NW="NW";var d=function(){function i(i){var t=i.worldOrigin,e=i.baseTileOrigin,n=i.baseTileDimensions,s=i.getGlobalDimensions,o=i.getWorldPosition,l=i.getWorldScale;this.worldOrigin=h,this.baseTileOrigin=h,this.tiles=[],this.map={},this.worldOrigin=t||h,this.baseTileOrigin=e||h,this.baseTileDimensions=n,this.getGlobalDimensions=s,this.getWorldPosition=o||function(){return r},this.getWorldScale=l||function(){return a}}var t,e=i.prototype;return e.add=function(i,t,e,n){void 0===e&&(e=this.baseTileDimensions),void 0===n&&(n=this.baseTileOrigin),this.tiles.push(i);var s=this.tiles[this.tiles.indexOf(i)];return l(this.map,[t.z,t.x,t.y],s),this._project(this._getAbsolutePosition(t),e,n)},e.get=function(i){return u(this.map,[i.z||0,i.x,i.y])},e.getColumn=function(i,t){return Object.entries(t||this.map).map(function(t){return u(t[1],[i.x,i.y])})},e.move=function(i,t,e,n){void 0===e&&(e=this.baseTileDimensions),void 0===n&&(n=this.baseTileOrigin);var s=this.remove(i);return s?this.add(s,t,e,n):null},e.remove=function(i){var t=this.get(i);return t?(delete this.map[i.z][i.x][i.y],this.tiles.splice(this.tiles.indexOf(t),1)[0]):null},e.toPoint=function(i,t,e){void 0===t&&(t=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin);var n=this.getWorldScale(),s=this.getWorldPosition(),o=this._project(this._getAbsolutePosition(i,t,e));return o.x+=o.x*(n.x-1)+s.x,o.y+=o.y*(n.y-1)+s.y,o},e.toTile=function(i,t,e){void 0===t&&(t=this.baseTileDimensions);var n=this._unproject(i);return{x:Math.round(n.x/t.width),y:Math.round(n.y/t.height),z:i.z||0}},e.centerToTile=function(i){return this.centerToPoint(this.toPoint(i))},e.centerToPoint=function(i){var t=this.getGlobalDimensions(),e=this.getWorldPosition();return{x:e.x+t.width/2-i.x,y:e.y+t.height/2-i.y}},e.center=function(){return this.centerToTile(this.centerTile)},e.getBounds=function(){var i=Object.values(this.map),t=i.map(function(i){return Object.keys(i).map(Number)}).flat(),e=i.map(Object.values).flat().map(function(i){return Object.keys(i).map(Number)}).flat(),n=Math.min.apply(Math,t),s=Math.max.apply(Math,t),o=Math.min.apply(Math,e),r={x:0,y:0,width:s-o,height:Math.max.apply(Math,e)-o,depth:i.length};return r.x=Math.round(n+r.width/2),r.y=Math.round(o+r.height/2),r},e._project=function(i,t,e){var n=this.getGlobalDimensions();return{x:i.x+n.width*this.worldOrigin.x,y:i.y+n.height*this.worldOrigin.y,z:i.z||0}},e._unproject=function(i,t){void 0===t&&(t={x:0,y:0,z:0});var e=this.getGlobalDimensions(),n=e.height;return t.x=i.x-e.width*this.worldOrigin.x,t.y=i.y-n*this.worldOrigin.y+(i.z||0),t.z=i.z,t},e._getAbsolutePosition=function(i,t,e){return{x:this.baseTileDimensions.width*i.x,y:this.baseTileDimensions.height*i.y,z:i.z}},(t=[{key:"centerTile",get:function(){return this.getBounds()}}])&&function(i,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(i,n.key,n)}}(i.prototype,t),i}(),g=function(i){var e,s;function o(e){var s,o=e.angle,r=void 0===o?n:o,h=e.clamp,a=void 0===h||h,l=function(i,t){if(null==i)return{};var e,n,s={},o=Object.keys(i);for(n=0;n<o.length;n++)t.indexOf(e=o[n])>=0||(s[e]=i[e]);return s}(e,["angle","clamp"]);return(s=i.call(this,t({},l))||this).depthMap={},s.angle=r,s.angleCos=Math.cos(s.angle),s.angleSin=Math.sin(s.angle),s.clamp=a,s.baseOrigin={x:s.baseTileDimensions.width*s.baseTileOrigin.x,y:s.baseTileDimensions.height*s.baseTileOrigin.y},s.baseSurfaceHeight=s.baseTileDimensions.height-s.baseTileDimensions.depth,s.baseSurfaceHalfHeight=s.baseSurfaceHeight/2,s}s=i,(e=o).prototype=Object.create(s.prototype),e.prototype.constructor=e,e.__proto__=s;var r=o.prototype;return r.add=function(i,t,e,n){void 0===e&&(e=this.baseTileDimensions),void 0===n&&(n=this.baseTileOrigin),this.tiles.push(i);var s=this.tiles[this.tiles.indexOf(i)];if(e!==this.baseTileDimensions)for(var o=e.depth/this.baseTileDimensions.depth,r=t.z;o>0;o--,r++)l(this.depthMap,[r,t.x,t.y],o>1?this.baseTileDimensions.depth:this.baseTileDimensions.depth*o),l(this.map,[r,t.x,t.y],s);else l(this.depthMap,[t.z,t.x,t.y],this.baseTileDimensions.depth),l(this.map,[t.z,t.x,t.y],s);return this._project(this._getAbsolutePosition(t),e,n,c(this.getColumn(t,this.depthMap).slice(1,t.z)))},r.remove=function(i){var t=this,e=this.get(i);return e?(Object.entries(this.map).forEach(function(n){var s=n[0],o=n[1];try{o[i.x][i.y]===e&&(delete t.depthMap[s][i.x][i.y],delete t.map[s][i.x][i.y])}catch(i){}}),this.tiles.splice(this.tiles.indexOf(e),1)[0]):null},r.toTile=function(i,t,e){void 0===t&&(t=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin);var n=this._unproject(i),s=t.width*e.x,o=t.width*e.y;return n.x=Math.floor((n.x+s)/s),n.y=Math.floor((n.y+o)/o),n.z=n.z||0,n},r._project=function(i,t,e,n){void 0===t&&(t=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin),void 0===n&&(n=0);var s=this.getGlobalDimensions(),o={x:(i.x-i.y)*this.angleCos+s.width*this.worldOrigin.x,y:(i.x+i.y)*this.angleSin+s.height*this.worldOrigin.y,z:(i.x+i.y)*(i.z+1||1)};return t!==this.baseTileDimensions?(o.y-=this.baseSurfaceHalfHeight+0-this.baseTileOrigin.y,o.y+=t.height*e.y-(t.height-(t.height-t.depth)/2),o.y-=n):o.y-=this.baseTileDimensions.depth*i.z,this.clamp&&(o.x=~~(o.x+(o.x>0?.5:-.5)),o.y=~~(o.y+(o.y>0?.5:-.5))),o},r._unproject=function(i,t){void 0===t&&(t={x:0,y:0,z:0});var e=this.getGlobalDimensions(),n=i.x-e.width*this.worldOrigin.x,s=i.y-e.height*this.worldOrigin.y;return t.x=n/(2*this.angleCos)+s/(2*this.angleSin),t.y=-n/(2*this.angleCos)+s/(2*this.angleSin),t.z=i.z||0,t},r._getAbsolutePosition=function(i,t,e){return void 0===t&&(t=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin),{x:t.width*e.x*i.x,y:t.width*e.y*i.y,z:i.z||0}},o}(d);i.CLASSIC=n,i.FULL=a,i.ISOMETRIC=s,i.IsoTilemap=g,i.MIDDLE=h,i.MILITARY=o,i.TOP_LEFT=r,i.Tilemap=d,i.get=u,i.getDirection=function(t,e){var n=e.x-t.x,s=e.y-t.y;return 0===n&&s<0?i.DIRECTION.N:n>0&&s<0?i.DIRECTION.NE:n>0&&0===s?i.DIRECTION.E:n>0&&s>0?i.DIRECTION.SE:0===n&&s>0?i.DIRECTION.S:n<0&&s>0?i.DIRECTION.SW:n<0&&0===s?i.DIRECTION.W:n<0&&s<0?i.DIRECTION.NW:i.DIRECTION.NONE},i.getDistance=function(i,t){return Math.sqrt((t.x-i.x)*(t.x-i.x)+(t.y-i.y)*(t.y-i.y))},i.set=l,i.sum=c});
//# sourceMappingURL=index.umd.js.map
