function t(){return(t=Object.assign||function(t){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[s]=e[s])}return t}).apply(this,arguments)}var i,e=Math.atan(.5),s=Math.PI/6,n=Math.PI/4,r={x:.5,y:.5};function o(t,i,e){for(var s=t;i.length-1;){var n=i.shift();n in s||(s[n]={}),s=s[n]}return s[i[0]]=e,s[i[0]]}function h(t,i,e){for(var s=t;i.length;){var n=i.shift();if(!(n in s)){if(!e)return;s[n]={},i.length||(s[n]=e)}s=s[n]}return s}function a(t){return t.reduce(function(t,i){return i?t+i:t},0)}(i=exports.DIRECTION||(exports.DIRECTION={})).NONE="NONE",i.N="N",i.NE="NE",i.E="E",i.SE="SE",i.S="S",i.SW="SW",i.W="W",i.NW="NW";var l=function(){function t(t){var i=t.worldOrigin,e=t.baseTileOrigin,s=t.baseTileDimensions,n=t.getGlobalDimensions,o=t.getWorldPosition,h=t.getWorldScale;this.worldOrigin=r,this.baseTileOrigin=r,this.tiles=[],this.map={},this.worldOrigin=i||r,this.baseTileOrigin=e||r,this.baseTileDimensions=s,this.getGlobalDimensions=n,this.getWorldPosition=o,this.getWorldScale=h}var i,e=t.prototype;return e.add=function(t,i,e,s){void 0===e&&(e=this.baseTileDimensions),void 0===s&&(s=this.baseTileOrigin),this.tiles.push(t);var n=this.tiles[this.tiles.indexOf(t)];return o(this.map,[i.z,i.x,i.y],n),this._project(this._getAbsolutePosition(i),e,s)},e.get=function(t){return h(this.map,[t.z||0,t.x,t.y])},e.getColumn=function(t,i){return Object.entries(i||this.map).map(function(i){return h(i[1],[t.x,t.y])})},e.move=function(t,i,e,s){void 0===e&&(e=this.baseTileDimensions),void 0===s&&(s=this.baseTileOrigin);var n=this.remove(t);return n?this.add(n,i,e,s):null},e.remove=function(t){var i=this.get(t);return i?(delete this.map[t.z][t.x][t.y],this.tiles.splice(this.tiles.indexOf(i),1)[0]):null},e.toPoint=function(t,i,e){void 0===i&&(i=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin);var s=this.getWorldScale(),n=this.getWorldPosition(),r=this._project(this._getAbsolutePosition(t,i,e));return r.x+=r.x*(s.x-1)+n.x,r.y+=r.y*(s.y-1)+n.y,r},e.toTile=function(t,i,e){void 0===i&&(i=this.baseTileDimensions);var s=this._unproject(t);return{x:Math.round(s.x/i.width),y:Math.round(s.y/i.height),z:t.z||0}},e.centerToTile=function(t){return this.centerToPoint(this.toPoint(t))},e.centerToPoint=function(t){var i=this.getGlobalDimensions(),e=this.getWorldPosition();return{x:e.x+i.width/2-t.x,y:e.y+i.height/2-t.y}},e.center=function(){return this.centerToTile(this.centerTile)},e.getBounds=function(){var t=Object.values(this.map),i=t.map(function(t){return Object.keys(t).map(Number)}).flat(),e=t.map(Object.values).flat().map(function(t){return Object.keys(t).map(Number)}).flat(),s=Math.min.apply(Math,i),n=Math.max.apply(Math,i),r=Math.min.apply(Math,e),o={x:0,y:0,width:n-r,height:Math.max.apply(Math,e)-r,depth:t.length};return o.x=Math.round(s+o.width/2),o.y=Math.round(r+o.height/2),o},e._project=function(t,i,e){var s=this.getGlobalDimensions();return{x:t.x+s.width*this.worldOrigin.x,y:t.y+s.height*this.worldOrigin.y,z:t.z||0}},e._unproject=function(t,i){void 0===i&&(i={x:0,y:0,z:0});var e=this.getGlobalDimensions(),s=e.height;return i.x=t.x-e.width*this.worldOrigin.x,i.y=t.y-s*this.worldOrigin.y+(t.z||0),i.z=t.z,i},e._getAbsolutePosition=function(t,i,e){return{x:this.baseTileDimensions.width*t.x,y:this.baseTileDimensions.height*t.y,z:t.z}},(i=[{key:"centerTile",get:function(){return this.getBounds()}}])&&function(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}(t.prototype,i),t}(),u=function(i){var s,n;function r(s){var n,r=s.projectionAngle,o=void 0===r?e:r,h=function(t,i){if(null==t)return{};var e,s,n={},r=Object.keys(t);for(s=0;s<r.length;s++)i.indexOf(e=r[s])>=0||(n[e]=t[e]);return n}(s,["projectionAngle"]);return(n=i.call(this,t({},h))||this).transform=null,n.depthMap={},n.transform=[Math.cos(o),Math.sin(o)],n.baseOrigin={x:n.baseTileDimensions.width*n.baseTileOrigin.x,y:n.baseTileDimensions.height*n.baseTileOrigin.y},n.baseSurfaceHeight=n.baseTileDimensions.height-n.baseTileDimensions.depth,n.baseSurfaceHalfHeight=n.baseSurfaceHeight/2,n}n=i,(s=r).prototype=Object.create(n.prototype),s.prototype.constructor=s,s.__proto__=n;var h=r.prototype;return h.add=function(t,i,e,s){void 0===e&&(e=this.baseTileDimensions),void 0===s&&(s=this.baseTileOrigin),this.tiles.push(t);var n=this.tiles[this.tiles.indexOf(t)];if(e!==this.baseTileDimensions)for(var r=e.depth/this.baseTileDimensions.depth,h=i.z;r>0;r--,h++)o(this.depthMap,[h,i.x,i.y],r>1?this.baseTileDimensions.depth:this.baseTileDimensions.depth*r),o(this.map,[h,i.x,i.y],n);else o(this.depthMap,[i.z,i.x,i.y],this.baseTileDimensions.depth),o(this.map,[i.z,i.x,i.y],n);return this._project(this._getAbsolutePosition(i),e,s,a(this.getColumn(i,this.depthMap).slice(1,i.z)))},h.remove=function(t){var i=this,e=this.get(t);return e?(Object.entries(this.map).forEach(function(s){var n=s[0],r=s[1];try{r[t.x][t.y]===e&&(delete i.depthMap[n][t.x][t.y],delete i.map[n][t.x][t.y])}catch(t){}}),this.tiles.splice(this.tiles.indexOf(e),1)[0]):null},h.toTile=function(t,i,e){void 0===i&&(i=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin);var s=this._unproject(t),n=i.width*e.x,r=i.width*e.y;return s.x=Math.floor((s.x+n)/n),s.y=Math.floor((s.y+r)/r),s.z=s.z||0,s},h._project=function(t,i,e,s){void 0===i&&(i=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin),void 0===s&&(s=0);var n={x:(t.x-t.y)*this.transform[0],y:(t.x+t.y)*this.transform[1],z:t.z||0},r=this.getGlobalDimensions(),o=r.height;return n.x+=r.width*this.worldOrigin.x,n.y+=+o*this.worldOrigin.y,n.z=(t.x+t.y)*(t.z+1||1),i!==this.baseTileDimensions?(n.y-=this.baseSurfaceHalfHeight+0-this.baseTileOrigin.y,n.y+=i.height*e.y-(i.height-(i.height-i.depth)/2),n.y-=s):n.y-=this.baseTileDimensions.depth*t.z,n},h._unproject=function(t,i){void 0===i&&(i={x:0,y:0,z:0});var e=this.getGlobalDimensions(),s=t.x-e.width*this.worldOrigin.x,n=t.y-e.height*this.worldOrigin.y;return i.x=s/(2*this.transform[0])+n/(2*this.transform[1]),i.y=-s/(2*this.transform[0])+n/(2*this.transform[1]),i.z=t.z||0,i},h._getAbsolutePosition=function(t,i,e){return void 0===i&&(i=this.baseTileDimensions),void 0===e&&(e=this.baseTileOrigin),{x:i.width*e.x*t.x,y:i.width*e.y*t.y,z:t.z||0}},r}(l);exports.CLASSIC=e,exports.ISOMETRIC=s,exports.IsoTilemap=u,exports.MIDDLE=r,exports.MILITARY=n,exports.TOP_LEFT={x:0,y:0},exports.Tilemap=l,exports.ZERO=0,exports.get=h,exports.getDistance=function(t,i){return Math.sqrt((i.x-t.x)*(i.x-t.x)+(i.y-t.y)*(i.y-t.y))},exports.getIsoDirection=function(t,i){var e=i.x-t.x,s=i.y-t.y;return 0===e&&s<0?exports.DIRECTION.N:e>0&&s<0?exports.DIRECTION.NE:e>0&&0===s?exports.DIRECTION.E:e>0&&s>0?exports.DIRECTION.SE:0===e&&s>0?exports.DIRECTION.S:e<0&&s>0?exports.DIRECTION.SW:e<0&&0===s?exports.DIRECTION.W:e<0&&s<0?exports.DIRECTION.NW:exports.DIRECTION.NONE},exports.set=o,exports.sum=a;
//# sourceMappingURL=index.js.map
